# ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Network Segmentation ‡πÅ‡∏•‡∏∞ Firewall Rules

‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå Omada (ER7206 + OC200) ‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå‡∏´‡∏•‡∏±‡∏Å‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ **VLANs (Virtual LANs)** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏ö‡πà‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ **Firewall ACLs (Access Control Lists)** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Å‡∏≤‡∏£‡∏à‡∏£‡∏≤‡∏à‡∏£‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô

‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ï‡∏≤‡∏°‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á "Zero Trust" ‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏õ‡∏±‡∏ï‡∏¢‡∏Å‡∏£‡∏£‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏±‡∏ö

---

## 1. üåê ‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡πà‡∏á‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢ (VLAN Segmentation)

‡πÉ‡∏ô Omada Controller (OC200) ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏õ‡∏ó‡∏µ‡πà `Settings > Wired Networks > LAN` ‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢‡∏¢‡πà‡∏≠‡∏¢ (VLANs) ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:

* **VLAN 10: SERVER**
  * **IP Range:** 192.168.10.x
  * **‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå:** ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå Server (QNAP ‡πÅ‡∏•‡∏∞ ASUSTOR)

* **VLAN 20 MGMT(Default): Management**
  * **IP Range:** 192.168.20.x
  * **‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå:** ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå Network (ER7206, OC200, Switches) ‡πÅ‡∏•‡∏∞ PC ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö (Admin) ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô

* **VLAN 30: USER**
  * **IP Range:** 192.168.30.x
  * **‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå:** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö PC, Notebook, ‡πÅ‡∏•‡∏∞ Wi-Fi ‡∏Ç‡∏≠‡∏á‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö (‡πÄ‡∏ä‡πà‡∏ô `lcbp3.np-dms.work`)

* **VLAN 40: CCTV**
  * **IP Range:** 192.168.40.x
  * **‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå:** ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå CCTV ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô

* **VLAN 50 VOICEt**
  * **IP Range:** 192.168.50.x
  * **‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå:** ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå IP Phone ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô

* **VLAN 60 DMZ**
  * **IP Range:** 192.168.60.x
  * **‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå:** ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Network DMZ ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
  
* **VLAN 70: GUEST / Untrusted** (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Wi-Fi ‡πÅ‡∏Ç‡∏Å)
  * **IP Range:** 192.168.70.x
  * **‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå:** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Wi-Fi ‡πÅ‡∏Ç‡∏Å (Guest) ‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡πÇ‡∏î‡∏¢‡πÄ‡∏î‡πá‡∏î‡∏Ç‡∏≤‡∏î

**‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Port Switch:**
‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á VLANs ‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡πÑ‡∏õ‡∏ó‡∏µ‡πà `Devices` > ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Switch ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì > `Ports` > ‡∏Å‡∏≥‡∏´‡∏ô‡∏î Port Profile:

* Port ‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏µ‡∏¢‡∏ö QNAP NAS: ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Profile ‡πÄ‡∏õ‡πá‡∏ô **VLAN 10**
* Port ‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏µ‡∏¢‡∏ö PC ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô: ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Profile ‡πÄ‡∏õ‡πá‡∏ô **VLAN 20**

---

## 2. üî• Firewall Rules (ACLs)

‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ñ‡∏£‡∏±‡∏ö ‡πÑ‡∏õ‡∏ó‡∏µ‡πà `Settings > Network Security > ACL (Access Control)`

‡∏Å‡∏é‡∏Ç‡∏≠‡∏á Firewall ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏à‡∏≤‡∏Å‡∏ö‡∏ô‡∏•‡∏á‡∏•‡πà‡∏≤‡∏á (‡∏Ç‡πâ‡∏≠ 1 ‡∏ó‡∏≥‡∏Å‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠ 2)

---

### 2.1 IP Groups & Port Groups

**IP Groups** (‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ô `Settings > Network Security > Groups`):

| Group Name         | Members                                           |
| :----------------- | :------------------------------------------------ |
| `Server`           | 192.168.10.8, 192.168.10.9, 192.168.10.111        |
| `Omada-Controller` | 192.168.20.250 (OC200 IP)                           |
| `DHCP-Gateways`    | 192.168.30.1, 192.168.70.1                        |
| `QNAP_Services`    | 192.168.10.8                                      |
| `Internal`         | 192.168.10.0/24, 192.168.20.0/24, 192.168.30.0/24 |
| `Blacklist`        | (Add malicious IPs as needed)                     |

**Port Groups**:

| Group Name   | Ports                                   |
| :----------- | :-------------------------------------- |
| `Web`        | TCP 443, 8443, 80, 81, 2222             |
| `Omada-Auth` | TCP 443, 8043, 8088, 8843, 29810-29814  |
| `VoIP`       | UDP 5060, 5061, 10000-20000 (SIP + RTP) |
| `DHCP`       | UDP 67, 68                              |

---

### 2.2 Switch ACL (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Omada OC200)

| ‡∏•‡∏≥‡∏î‡∏±‡∏ö  | Name                      | Policy | Source            | Destination                   | Ports                                     |
| :--- | :------------------------ | :----- | :---------------- | :---------------------------- | :---------------------------------------- |
| 1    | 01 Allow-User-DHCP        | Allow  | Network ‚Üí VLAN 30 | IP ‚Üí 192.168.30.1             | Port Group ‚Üí DHCP                         |
| 2    | 02 Allow-Guest-DHCP       | Allow  | Network ‚Üí VLAN 70 | IP ‚Üí 192.168.70.1             | Port Group ‚Üí DHCP                         |
| 3    | 03 Allow-WiFi-Auth        | Allow  | Network ‚Üí VLAN 30 | IP Group ‚Üí Omada-Controller   | Port Group ‚Üí Omada-Auth                   |
| 4    | 04 Allow-Guest-WiFi-Auth  | Allow  | Network ‚Üí VLAN 70 | IP Group ‚Üí Omada-Controller   | Port Group ‚Üí Omada-Auth                   |
| 5    | 05 Isolate-Guests         | Deny   | Network ‚Üí VLAN 70 | Network ‚Üí VLAN 10, 20, 30, 60 | All                                       |
| 6    | 06 Isolate-Servers        | Deny   | Network ‚Üí VLAN 10 | Network ‚Üí VLAN 30 (USER)      | All                                       |
| 7    | 07 Block-User-to-Mgmt     | Deny   | Network ‚Üí VLAN 30 | Network ‚Üí VLAN 20 (MGMT)      | All                                       |
| 8    | 08 Allow-User-to-Services | Allow  | Network ‚Üí VLAN 30 | IP ‚Üí QNAP (192.168.10.8)      | Port Group ‚Üí Web (443,8443, 80, 81, 2222) |
| 9    | 09 Allow-Voice-to-User    | Allow  | Network ‚Üí VLAN 50 | Network ‚Üí VLAN 30,50          | All                                       |
| 10   | 10 Allow-MGMT-to-All      | Allow  | Network ‚Üí VLAN 20 | Any                           | All                                       |
| 11   | 11 Allow-Server-Internal  | Allow  | IP Group : Server | IP Group : Server             | All                                       |
| 12   | 12 Allow-Server ‚Üí CCTV    | Allow  | IP Group : Server | Network ‚Üí VLAN 40 (CCTV)      | All                                       |
| 13   | 100 (Default)             | Deny   | Any               | Any                           | All                                       |

> ‚ö†Ô∏è **‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç - ‡∏•‡∏≥‡∏î‡∏±‡∏ö ACL:**
> 1. **Allow rules ‡∏Å‡πà‡∏≠‡∏ô** - DHCP (#1-2) ‡πÅ‡∏•‡∏∞ WiFi-Auth (#3-4) ‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà **‡∏ö‡∏ô‡∏™‡∏∏‡∏î**
> 2. **Isolate/Deny rules ‡∏ñ‡∏±‡∏î‡∏°‡∏≤** - (#5-7) block traffic ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
> 3. **Allow specific rules** - (#8-12) ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï traffic ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠
> 4. **Default Deny ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î** - (#13) block ‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà match

---

### 2.3 Gateway ACL (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Omada ER7206)

| ‡∏•‡∏≥‡∏î‡∏±‡∏ö  | Name                    | Policy | Direction | PROTOCOLS | Source               | Destination                  |
| :--- | :---------------------- | :----- | :-------- | :-------- | :------------------- | :--------------------------- |
| 1    | 01 Blacklist            | Deny   | [WAN2] IN | All       | IP Group:Blacklist   | IP Group:Internal            |
| 2    | 02 Geo                  | Permit | [WAN2] IN | All       | Location Group:Allow | IP Group:Internal            |
| 3    | 03 Allow-Voice-Internet | Permit | LAN->WAN  | UDP       | Network ‚Üí VLAN 50    | Any                          |
| 4    | 04 Internal ‚Üí Internet  | Permit | LAN->WAN  | All       | IP Group:Internal    | Domain Group:DomainGroup_Any |

> üí° **‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:** Rule #3 `Allow-Voice-Internet` ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï IP Phone (VLAN 50) ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Cloud PBX ‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å ‡∏ú‡πà‡∏≤‡∏ô Port Group ‚Üí VoIP (UDP 5060, 5061, 10000-20000)

---

## 3. üö™ Port Forwarding (‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î Service ‡∏™‡∏π‡πà‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞)

‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà Firewall ACL ‡πÅ‡∏ï‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏ô‡∏≠‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏±‡∏ö
‡πÑ‡∏õ‡∏ó‡∏µ‡πà `Settings > Transmission > Port Forwarding`

‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏é‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏à‡∏£‡∏≤‡∏à‡∏£‡∏à‡∏≤‡∏Å WAN (‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï) ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Nginx Proxy Manager (NPM) ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô QNAP (VLAN 10)

* **Name:** Allow-NPM-HTTPS
* **External Port:** 443
* **Internal Port:** 443
* **Internal IP:** `192.168.10.8` (IP ‡∏Ç‡∏≠‡∏á QNAP)
* **Protocol:** TCP

* **Name:** Allow-NPM-HTTP (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Let's Encrypt)
* **External Port:** 80
* **Internal Port:** 80
* **Internal IP:** `192.168.10.8` (IP ‡∏Ç‡∏≠‡∏á QNAP)
* **Protocol:** TCP

### ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏±‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠

1. **‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å** -> `https://lcbp3.np-dms.work`
2. **ER7206** ‡∏£‡∏±‡∏ö‡∏ó‡∏µ‡πà Port 443
3. **Port Forwarding** ‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏¢‡∏±‡∏á `192.168.10.8:443` (QNAP NPM)
4. **NPM** (‡∏ö‡∏ô QNAP) ‡∏™‡πà‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏¢‡∏±‡∏á `backend:3000` ‡∏´‡∏£‡∏∑‡∏≠ `frontend:3000` ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô Docker
5. **‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô (Office)** -> `https://lcbp3.np-dms.work`
6. **Firewall ACL** (‡∏Å‡∏é‡∏Ç‡πâ‡∏≠ 4) ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ VLAN 30 ‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö `192.168.10.8:443`
7. (‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 3-4 ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°)

‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏≤‡∏°‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏¢‡∏Å‡∏™‡πà‡∏ß‡∏ô Server ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô ‡∏ã‡∏∂‡πà‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏ß‡∏á LAN ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏°‡∏≤‡∏Å‡∏Ñ‡∏£‡∏±‡∏ö
