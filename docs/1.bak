‡∏ú‡∏°‡πÑ‡∏î‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏ü‡∏•‡πå `FullStackJS_Guidelines01.md` ‡πÅ‡∏•‡∏∞ `01_lcbp3_v1_1_0.sql` ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏•‡∏∞‡πÑ‡∏î‡πâ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÑ‡∏ü‡∏•‡πå Guidelines (Markdown) ‡πÉ‡∏´‡πâ‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (SQL) ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÑ‡∏ß‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡∏Ñ‡∏£‡∏±‡∏ö

‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ñ‡∏∑‡∏≠:

1.  **‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ UI (UI Conflict):** ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏±‡∏î‡πÅ‡∏¢‡πâ‡∏á‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ó‡∏±‡πâ‡∏á **Tailwind/Shadcn** ‡πÅ‡∏•‡∏∞ **Bootstrap** ‡∏ú‡∏°‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤ UI ‡πÑ‡∏õ‡∏ó‡∏µ‡πà **Tailwind/Shadcn** ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏±‡∏Å‡∏û‡∏±‡∏í‡∏ô‡∏≤ (Frontend Developer Profile) ‡πÅ‡∏•‡∏∞‡∏•‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á Bootstrap ‡∏ó‡∏µ‡πà‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ
2.  **DMS-Specific Conventions:** ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏™‡∏Ñ‡∏µ‡∏° SQL ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
      * ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡πÄ‡∏õ‡πá‡∏ô **LCBP3-DMS**
      * ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á **Domain Modules** ‡πÉ‡∏´‡πâ‡∏™‡∏∞‡∏ó‡πâ‡∏≠‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏à‡∏£‡∏¥‡∏á (‡πÄ‡∏ä‡πà‡∏ô `correspondences` ‡πÄ‡∏õ‡πá‡∏ô‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏•‡∏≤‡∏á, ‡πÄ‡∏û‡∏¥‡πà‡∏° `circulations`)
      * ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≤‡∏£‡∏≤‡∏á **AuditLog** ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ü‡∏¥‡∏•‡∏î‡πå‡πÉ‡∏ô SQL (‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏û‡∏¥‡πà‡∏° `entity_type`, `details_json`, `ip_address`)
      * ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á **RBAC Permissions** ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á `permissions` ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
      * ‡∏ä‡∏µ‡πâ‡πÅ‡∏à‡∏á
        ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á **File Handling** ‡∏ß‡πà‡∏≤‡∏ï‡∏≤‡∏£‡∏≤‡∏á `attachments` ‡∏à‡∏∞‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏ú‡πà‡∏≤‡∏ô `correspondence_id`
      * ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡πà‡∏ß‡∏ô **Reporting** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏ñ‡∏∂‡∏á `VIEWS` (‡πÄ‡∏ä‡πà‡∏ô `v_current_rfas`) ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡πÉ‡∏ô SQL
      * ‡∏¢‡πâ‡∏≤‡∏¢‡∏™‡πà‡∏ß‡∏ô **"Recommended Enhancements"** (‡πÄ‡∏ä‡πà‡∏ô soft delete, indexes) ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô SQL ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏ä‡∏∑‡πà‡∏≠ **"Implemented Standards"** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏∞‡∏ó‡πâ‡∏≠‡∏ô‡∏ß‡πà‡∏≤‡∏á‡∏≤‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß

‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡πÑ‡∏ü‡∏•‡πå `FullStackJS_Guidelines01.md` ‡∏â‡∏ö‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö:

-----

# FullStackJS Development Guidelines

## üß† General Philosophy

Unified best practices for **NestJS Backend**, **NextJS Frontend**, and **Tailwind-based UI/UX** development in TypeScript environments.
Focus on **clarity**, **maintainability**, **consistency**, and **accessibility** across the entire stack.

-----

## ‚öôÔ∏è TypeScript General Guidelines

### Basic Principles

  - Use **English** for all code and documentation.
  - Explicitly type all variables, parameters, and return values.
  - Avoid `any`; create custom types or interfaces.
  - Use **JSDoc** for public classes and methods.
  - Export only **one main symbol** per file.
  - Avoid blank lines within functions.

### Naming Conventions

| Entity | Convention | Example |
|:--|:--|:--|
| Classes | PascalCase | `UserService` |
| Variables & Functions | camelCase | `getUserInfo` |
| Files & Folders | kebab-case | `user-service.ts` |
| Environment Variables | UPPERCASE | `DATABASE_URL` |
| Booleans | Verb + Noun | `isActive`, `canDelete`, `hasPermission` |

Use full words ‚Äî no abbreviations ‚Äî except for standard ones (`API`, `URL`, `req`, `res`, `err`, `ctx`).

-----

## üß© Functions

  - Write short, single-purpose functions (\<20 lines).
  - Use **early returns** to reduce nesting.
  - Use **map**, **filter**, **reduce** instead of loops when suitable.
  - Prefer **arrow functions** for short logic, **named functions** otherwise.
  - Use **default parameters** over null checks.
  - Group multiple parameters into a single object (RO-RO pattern).
  - Return typed objects, not primitives.
  - Maintain a single abstraction level per function.

-----

## üß± Data Handling

  - Encapsulate data in composite types.
  - Use **immutability** with `readonly` and `as const`.
  - Perform validations in classes or DTOs, not within business functions.
  - Always validate data using typed DTOs.

-----

## üß∞ Classes

  - Follow **SOLID** principles.
  - Prefer **composition over inheritance**.
  - Define **interfaces** for contracts.
  - Keep classes focused and small (\<200 lines, \<10 methods, \<10 properties).

-----

## üö® Error Handling

  - Use exceptions for unexpected errors.
  - Catch only to fix or add context; otherwise, use global error handlers.
  - Always provide meaningful error messages.

-----

## üß™ Testing (General)

  - Use the **Arrange‚ÄìAct‚ÄìAssert** pattern.
  - Use descriptive test variable names (`inputData`, `expectedOutput`).
  - Write **unit tests** for all public methods.
  - Mock external dependencies.
  - Add **acceptance tests** per module using Given‚ÄìWhen‚ÄìThen.

-----

# üèóÔ∏è Backend (NestJS)

### Principles

  - **Modular architecture**:
      - One module per domain.
      - Controller ‚Üí Service ‚Üí Repository (Model) structure.
  - DTOs validated with **class-validator**.
  - Use **MikroORM** (or TypeORM/Prisma) for persistence, aligning with the MariaDB schema.
  - Encapsulate reusable code in a **common module** (`@app/common`):
      - Configs, decorators, DTOs, guards, interceptors, notifications, shared services, types, validators.

### Core Functionalities

  - Global **filters** for exception handling.
  - **Middlewares** for request handling.
  - **Guards** for permissions and RBAC.
  - **Interceptors** for response transformation and logging.

### Testing

  - Use **Jest** for testing.
  - Test each controller and service.
  - Add `admin/test` endpoint as a smoke test.

-----

# üñ•Ô∏è Frontend (NextJS / React / UI)

### Developer Profile

Senior-level TypeScript + React/NextJS engineer.
Expert in **TailwindCSS**, **Shadcn/UI**, and **Radix** for UI development.

### Code Implementation Guidelines

  - Use **early returns** for clarity.
  - Always style with **TailwindCSS** classes.
  - Prefer `class:` conditional syntax (or `clsx` utility) over ternary operators in class strings.
  - Use **const arrow functions** for components and handlers.
  - Event handlers start with `handle...` (e.g., `handleClick`, `handleSubmit`).
  - Include accessibility attributes:
    `tabIndex="0"`, `aria-label`, `onKeyDown`, etc.
  - Ensure all code is **complete**, **tested**, and **DRY**.
  - Always import required modules explicitly.

### UI/UX with React

  - Use **semantic HTML**.
  - Apply **responsive Tailwind** classes (`sm:`, `md:`, `lg:`).
  - Maintain visual hierarchy with typography and spacing.
  - Use **Shadcn** components (Button, Input, Card, etc.) for consistent UI.
  - Keep components small and focused.
  - Use utility classes for quick styling (spacing, colors, text, etc.).
  - Ensure **ARIA compliance** and semantic markup.

### Form Validation & Errors

  - Use client-side libraries like `zod` and `react-hook-form`.
  - Show errors with **alert components** or inline messages.
  - Include labels, placeholders, and feedback messages.

-----

# üîó Full Stack Integration Guidelines

| Aspect | Backend (NestJS) | Frontend (NextJS) | UI Layer (Tailwind/Shadcn) |
|:--|:--|:--|:--|
| API | REST / GraphQL Controllers | API hooks via fetch/axios/SWR | Components consuming data |
| Validation | `class-validator` DTOs | `zod` / `react-hook-form` | Shadcn form/input states |
| Auth | Guards, JWT | NextAuth / cookies | Auth UI states (loading, signed in) |
| Errors | Global filters | Toasts / modals | Alerts / feedback text |
| Testing | Jest (unit/e2e) | Vitest / Playwright | Visual regression |
| Styles | Scoped modules (if needed) | Tailwind / Shadcn | Tailwind utilities |
| Accessibility | Guards + filters | ARIA attributes | Semantic HTML |

-----

# üóÇÔ∏è DMS-Specific Conventions (LCBP3-DMS)

This section extends the general FullStackJS guidelines for the **LCBP3-DMS** project, focusing on document approval workflows (Correspondence, RFA, Drawing, Contract, Transmittal, Circulation).

## üß± Backend Domain Modules

Use a modular domain structure reflecting the SQL schema. `correspondences` should act as the central hub.

```
src/
 ‚îú‚îÄ modules/
 ‚îÇ   ‚îú‚îÄ correspondences/ (Core: Master documents, Revisions, Attachments)
 ‚îÇ   ‚îú‚îÄ rfas/             (RFA logic, Revisions, Workflows, Items)
 ‚îÇ   ‚îú‚îÄ drawings/         (ShopDrawings, ContractDrawings, Categories)
 ‚îÇ   ‚îú‚îÄ circulations/     (Internal circulation, Templates, Assignees)
 ‚îÇ   ‚îú‚îÄ transmittals/     (Transmittal logic, Items)
 ‚îÇ   ‚îú‚îÄ projects-contracts/ (Projects, Contracts, Organizations, Parties)
 ‚îÇ   ‚îú‚îÄ users-auth/       (Users, Roles, Permissions, Auth)
 ‚îÇ   ‚îú‚îÄ audit-log/
 ‚îÇ   ‚îî‚îÄ common/
```

### Naming Convention

| Entity | Example (from SQL) |
|:--|:--|
| Table | `correspondences`, `rfa_revisions`, `contract_parties` |
| Column | `correspondence_id`, `created_by`, `is_current` |
| DTO | `CreateRfaDto`, `UpdateCorrespondenceDto` |
| Controller | `rfas.controller.ts` |
| Service | `correspondences.service.ts` |

-----

## üß© RBAC & Permission Control

Use decorators to enforce access rights, referencing permissions from the `permissions` table.

```ts
@RequirePermission('rfas.respond') // Must match a 'permission_code'
@Put(':id')
updateRFA(@Param('id') id: string) {
  return this.rfaService.update(id);
}
```

### Roles

  - **SUPER\_ADMIN**: Full system access (from `roles` table).
  - **ADMIN**: Organization-level access.
  - **EDITOR**: Module-specific write access.
  - **VIEWER**: Read-only access.

### Example Permissions (from `permissions` table)

  - `rfas.view`, `rfas.create`, `rfas.respond`, `rfas.delete`
  - `drawings.view`, `drawings.upload`, `drawings.delete`
  - `corr.view`, `corr.manage`
  - `transmittals.manage`
  - `cirs.manage`
  - `project_parties.manage`

Seed mapping between roles and permissions via seeder scripts (as seen in SQL file).

-----

## üßæ AuditLog Standard

Log all CRUD and mapping operations to the `audit_logs` table.

| Field | Type (from SQL) | Description |
|:--|:--|:--|
| `audit_id` | `BIGINT` | Primary Key |
| `user_id` | `INT` | User performing the action (FK -\> users) |
| `action` | `VARCHAR(100)` | `rfa.create`, `correspondence.update`, `login.success` |
| `entity_type`| `VARCHAR(50)` | Table/module name, e.g., 'rfa', 'correspondence' |
| `entity_id` | `VARCHAR(50)` | Primary ID of the affected record |
| `details_json`| `JSON` | Contextual data (e.g., changed fields) |
| `ip_address` | `VARCHAR(45)` | Actor's IP address |
| `user_agent` | `VARCHAR(255)`| Actor's User Agent |
| `created_at` | `TIMESTAMP` | UTC timestamp |

Example implementation:

```ts
await this.auditLogService.log({
  userId: user.id,
  action: 'rfa.update_status',
  entityType: 'rfa_revisions',
  entityId: rfaRevision.id,
  detailsJson: { from: 'DFT', to: 'FAP' },
  ipAddress: req.ip,
});
```

-----

## üìÇ File Handling

### File Upload Standard

  - Centralize all uploads via the `attachments` table.
  - Upload path (convention): `/storage/{year}/{month}/`
  - Stored filename: Use `stored_filename` (e.g., UUID or hash) to prevent conflicts. `original_filename` is for display.
  - Allowed types: `pdf, dwg, docx, xlsx, zip`
  - Max size: **50 MB**
  - Store outside webroot.
  - Serve via secure endpoint `/files/:attachment_id/download`.

### Access Control

File access is not direct. The `/files/:attachment_id/download` endpoint must:

1.  Find the `attachment` record.
2.  Get its `correspondence_id`.
3.  Verify the user has permission to view that specific `correspondence` (or its related RFA, Transmittal, etc.).

-----

## üìä Reporting & Exports

### Reporting Views (from SQL)

Reports should be built primarily from the pre-defined database Views:

  - `v_current_correspondences`: For all current non-RFA document revisions.
  - `v_current_rfas`: For all current RFA revisions and their master data.
  - `v_contract_parties_all`: For auditing project/contract/organization relationships.

These views serve as the primary source for server-side reporting and data exports.

### Export Rules

  - Export formats: CSV, Excel, PDF.
  - Provide print view.
  - Include source entity link (e.g., `/rfas/:id`).

-----

## üßÆ Frontend: DataTable & Form Patterns

### DataTable (Server‚ÄëSide)

  - Endpoint: `/api/{module}?page=1&pageSize=20&sort=...&filter=...`
  - Must support: pagination, sorting, search, filters.
  - Always display latest revision inline (for RFA/Drawing).

### Form Standards

  - Dependent dropdowns must be implemented (as supported by schema):
      - Project ‚Üí Contract Drawing Volumes
      - Contract Drawing Category ‚Üí Sub-Category
      - RFA (Shop Drawing type) ‚Üí Linkable Shop Drawing Revisions
  - File upload: preview + validation (via `attachments` logic).
  - Submit via API with toast feedback.

-----

## üß≠ Dashboard & Activity Feed

### Dashboard Cards

  - Show latest Correspondences, RFAs, Circulations.
  - Include KPI summaries (e.g., "RFAs Pending Approval").
  - Include quick links to modules.

### Activity Feed

  - Display recent `audit_logs` actions (10 latest) relevant to the user.

<!-- end list -->

```ts
// Example API response
[
  { user: 'editor01', action: 'Updated RFA (LCBP3C1-RFA-001)', time: '2025-11-04T09:30Z' }
]
```

-----

## ‚úÖ Implemented Standards (from SQL v1.1.0)

This section confirms that the following best practices are already part of the database design and should be leveraged, not re-implemented.

  - ‚úÖ **Soft Delete:** Implemented via `deleted_at` columns on key tables (e.g., `correspondences`, `rfas`, `project_parties`). Logic must filter for `deleted_at IS NULL`.
  - ‚úÖ **Database Indexes:** The schema is heavily indexed on foreign keys and common query columns (e.g., `idx_rr_rfa`, `idx_cor_project`, `idx_cr_is_current`) for performance.
  - ‚úÖ **RBAC Structure:** A comprehensive `users`, `roles`, `permissions`, `user_roles`, and `user_project_roles` system is in place.
  - ‚úÖ **Data Seeding:** Master data (roles, permissions, organization\_roles, initial users, project parties) is included in the schema script.

## üß© Recommended Enhancements (Future)

  - ‚úÖ Implement Fulltext search on fields like `correspondence_revisions.title` or `details`.
  - ‚úÖ Create a background job (using **n8n** as noted in SQL comments) for RFA deadline reminders based on `due_date`.
  - ‚úÖ Add a periodic cleanup job for `attachments` that are not linked to any `correspondence_id` (orphaned files).

-----